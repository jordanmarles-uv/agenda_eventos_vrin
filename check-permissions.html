<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificar Permisos Google Sheet</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .step { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007bff; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .code { background: #f1f1f1; padding: 10px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üîê Verificar Permisos Google Sheet</h1>
    
    <div class="step">
        <h3>Paso 1: Verificar URL P√∫blica</h3>
        <p>Intenta abrir esta URL en tu navegador (debe funcionar sin login):</p>
        <div class="code">
            https://docs.google.com/spreadsheets/d/1kjYUKG-ERUyu_qjmuKDUkJiBGUajIdUF/pub?output=html
        </div>
        <button onclick="testPublicUrl()">Probar URL P√∫blica</button>
        <div id="publicResult"></div>
    </div>
    
    <div class="step">
        <h3>Paso 2: Verificar Permisos Actuales</h3>
        <p>Abre tu Google Sheet y sigue estos pasos:</p>
        <ol>
            <li>Click en "Compartir" (arriba a la derecha)</li>
            <li>Deber√≠a decir: <strong>"Cualquier persona con el enlace puede ver"</strong></li>
            <li>El rol debe ser: <strong>"Lector"</strong></li>
            <li>Si no est√° as√≠, haz clic en "Cambiar" y config√∫ralo</li>
        </ol>
    </div>
    
    <div class="step">
        <h3>Paso 3: Probar API sin Key</h3>
        <button onclick="testPublicAPI()">Probar API P√∫blica</button>
        <div id="apiResult"></div>
    </div>
    
    <div class="step">
        <h3>Paso 4: Probar API con Key</h3>
        <button onclick="testPrivateAPI()">Probar API con Key</button>
        <div id="privateResult"></div>
    </div>
    
    <script>
        const spreadsheetId = '1kjYUKG-ERUyu_qjmuKDUkJiBGUajIdUF';
        const apiKey = 'AIzaSyBVzq74cE3qC5nNVH--0mfjdSX7w7NP-a4';
        
        async function testPublicUrl() {
            const result = document.getElementById('publicResult');
            result.innerHTML = '<div class="warning">üîÑ Probando...</div>';
            
            try {
                const response = await fetch(`https://docs.google.com/spreadsheets/d/${spreadsheetId}/pub?output=html`);
                result.innerHTML = response.ok ? 
                    '<div class="success">‚úÖ URL p√∫blica accesible</div>' : 
                    '<div class="error">‚ùå URL p√∫blica no accesible - El Sheet no est√° compartido p√∫blicamente</div>';
            } catch (error) {
                result.innerHTML = '<div class="error">‚ùå Error de red: ' + error.message + '</div>';
            }
        }
        
        async function testPublicAPI() {
            const result = document.getElementById('apiResult');
            result.innerHTML = '<div class="warning">üîÑ Probando API p√∫blica...</div>';
            
            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}`;
                const response = await fetch(url);
                
                if (response.status === 403) {
                    result.innerHTML = '<div class="error">‚ùå Error 403: El Sheet no est√° compartido p√∫blicamente</div>';
                } else if (response.status === 404) {
                    result.innerHTML = '<div class="error">‚ùå Error 404: Spreadsheet ID incorrecto</div>';
                } else if (response.ok) {
                    const data = await response.json();
                    result.innerHTML = `<div class="success">‚úÖ API p√∫blica funciona: ${data.properties?.title}</div>`;
                } else {
                    result.innerHTML = `<div class="error">‚ùå Error ${response.status}: ${response.statusText}</div>`;
                }
            } catch (error) {
                result.innerHTML = '<div class="error">‚ùå Error: ' + error.message + '</div>';
            }
        }
        
        async function testPrivateAPI() {
            const result = document.getElementById('privateResult');
            result.innerHTML = '<div class="warning">üîÑ Probando API con Key...</div>';
            
            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/Sheet1?key=${apiKey}`;
                const response = await fetch(url);
                
                if (response.ok) {
                    const data = await response.json();
                    result.innerHTML = `<div class="success">‚úÖ API con Key funciona: ${data.values?.length || 0} filas encontradas</div>`;
                } else {
                    const error = await response.json();
                    result.innerHTML = `<div class="error">‚ùå Error ${response.status}: ${error.error?.message || response.statusText}</div>`;
                }
            } catch (error) {
                result.innerHTML = '<div class="error">‚ùå Error: ' + error.message + '</div>';
            }
        }
        
        // Auto-ejecutar pruebas
        window.onload = () => {
            testPublicUrl();
            setTimeout(() => testPublicAPI(), 1000);
        };
    </script>
</body>
</html>
