<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug API Google Sheets</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        pre { background: #f1f1f1; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Debug API Google Sheets</h1>
    
    <div id="results"></div>
    
    <script>
        const spreadsheetId = '1kjYUKG-ERUyu_qjmuKDUkJiBGUajIdUF';
        const sheetName = 'Formaci√≥n';
        const apiKey = 'AIzaSyBVzq74cE3qC5nNVH--0mfjdSX7w7NP-a4';
        
        async function debugAPI() {
            const results = document.getElementById('results');
            
            // Test 1: Verificar spreadsheet metadata
            results.innerHTML += '<div class="test"><h3>Test 1: Verificando Spreadsheet Metadata</h3>';
            try {
                const metaUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}?key=${apiKey}`;
                const metaResponse = await fetch(metaUrl);
                const metaData = await metaResponse.json();
                
                results.innerHTML += `<div class="success">‚úÖ Spreadsheet encontrado: ${metaData.properties.title}</div>`;
                results.innerHTML += `<div class="success">üìÑ Hojas disponibles:</div>`;
                
                metaData.sheets.forEach(sheet => {
                    results.innerHTML += `<div class="success">   - ${sheet.properties.title}</div>`;
                });
                
                // Verificar si existe la hoja "Formaci√≥n"
                const sheetExists = metaData.sheets.some(sheet => sheet.properties.title === sheetName);
                if (!sheetExists) {
                    results.innerHTML += `<div class="error">‚ùå La hoja "${sheetName}" no existe</div>`;
                    results.innerHTML += `<div class="warning">‚ö†Ô∏è Hojas disponibles: ${metaData.sheets.map(s => s.properties.title).join(', ')}</div>`;
                } else {
                    results.innerHTML += `<div class="success">‚úÖ Hoja "${sheetName}" encontrada</div>`;
                }
                
            } catch (error) {
                results.innerHTML += `<div class="error">‚ùå Error en metadata: ${error.message}</div>`;
            }
            results.innerHTML += '</div>';
            
            // Test 2: Intentar leer datos
            results.innerHTML += '<div class="test"><h3>Test 2: Intentando leer datos</h3>';
            try {
                const dataUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${encodeURIComponent(sheetName)}?key=${apiKey}`;
                results.innerHTML += `<div class="warning">üîó URL: ${dataUrl}</div>`;
                
                const dataResponse = await fetch(dataUrl);
                results.innerHTML += `<div class="warning">üì° Status: ${dataResponse.status} ${dataResponse.statusText}</div>`;
                
                if (!dataResponse.ok) {
                    const errorText = await dataResponse.text();
                    results.innerHTML += `<div class="error">‚ùå Error response: ${errorText}</div>`;
                } else {
                    const data = await dataResponse.json();
                    results.innerHTML += `<div class="success">‚úÖ Datos cargados: ${data.values ? data.values.length + ' filas' : 'Sin datos'}</div>`;
                    if (data.values && data.values.length > 0) {
                        results.innerHTML += `<pre>Headers: ${JSON.stringify(data.values[0], null, 2)}</pre>`;
                    }
                }
                
            } catch (error) {
                results.innerHTML += `<div class="error">‚ùå Error en datos: ${error.message}</div>`;
            }
            results.innerHTML += '</div>';
            
            // Test 3: Intentar con rango espec√≠fico
            results.innerHTML += '<div class="test"><h3>Test 3: Intentando con rango A1:Z1000</h3>';
            try {
                const rangeUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${encodeURIComponent(sheetName)}!A1:Z1000?key=${apiKey}`;
                results.innerHTML += `<div class="warning">üîó URL: ${rangeUrl}</div>`;
                
                const rangeResponse = await fetch(rangeUrl);
                results.innerHTML += `<div class="warning">üì° Status: ${rangeResponse.status} ${rangeResponse.statusText}</div>`;
                
                if (!rangeResponse.ok) {
                    const errorText = await rangeResponse.text();
                    results.innerHTML += `<div class="error">‚ùå Error response: ${errorText}</div>`;
                } else {
                    const data = await rangeResponse.json();
                    results.innerHTML += `<div class="success">‚úÖ Datos con rango: ${data.values ? data.values.length + ' filas' : 'Sin datos'}</div>`;
                }
                
            } catch (error) {
                results.innerHTML += `<div class="error">‚ùå Error en rango: ${error.message}</div>`;
            }
            results.innerHTML += '</div>';
        }
        
        // Ejecutar debug
        debugAPI();
    </script>
</body>
</html>
